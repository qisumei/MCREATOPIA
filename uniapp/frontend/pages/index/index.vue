<template>
  <!-- é¡µé¢æ ¹å®¹å™¨ -->
  <view class="container">
    <!-- é¡¶éƒ¨è‹±é›„åŒºåŸŸï¼Œå¸¦å·¦ä¾§æ·¡å…¥åŠ¨ç”» -->
    <view class="hero fade-in-left">
      <!-- æœåŠ¡å™¨logoï¼Œå¯ç‚¹å‡»é¢„è§ˆ -->
      <image 
        src="/static/logo.png" 
        class="logo zoomable-img" 
        mode="widthFix"  <!-- å®½åº¦è‡ªé€‚åº”ï¼Œé«˜åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾ -->
        @click="previewImage('/static/logo.png')"  <!-- ç‚¹å‡»é¢„è§ˆå›¾ç‰‡ -->
      ></image>
      <text class="server-title">MCREATOPIA</text>  <!-- æœåŠ¡å™¨åç§° -->
      <text class="server-subtitle">åˆ›é€  Â· æ¢ç´¢ Â· å·¥ä¸š</text>  <!-- å‰¯æ ‡é¢˜ -->
    </view>

    <!-- å¯¼èˆªç½‘æ ¼ï¼Œå¸¦å³ä¾§æ·¡å…¥åŠ¨ç”» -->
    <view class="grid-nav fade-in-right">
      <!-- è½¬æ­£ç”³è¯·å¯¼èˆªé¡¹ -->
      <view class="nav-item" @click="goPage('/pages/whitelist/quiz')">
        <text class="icon">âœ…</text>
        <text class="label">è½¬æ­£ç”³è¯·</text>
      </view>
      <!-- æœåŠ¡å™¨é¡»çŸ¥å¯¼èˆªé¡¹ -->
      <view class="nav-item" @click="goPage('/pages/rules/rules')">
        <text class="icon">ğŸ“œ</text>
        <text class="label">æœåŠ¡å™¨é¡»çŸ¥</text>
      </view>
      <!-- å…¥æœæŒ‡å—å¯¼èˆªé¡¹ -->
      <view class="nav-item" @click="goPage('/pages/guide/guide')">
        <text class="icon">ğŸ“–</text>
        <text class="label">å…¥æœæŒ‡å—</text>
      </view>
      <!-- æ¨¡ç»„ä»‹ç»å¯¼èˆªé¡¹ -->
      <view class="nav-item" @click="goPage('/pages/mods/mods')">
        <text class="icon">ğŸ“¦</text>
        <text class="label">æ¨¡ç»„ä»‹ç»</text>
      </view>
      <!-- èµåŠ©é¸£è°¢å¯¼èˆªé¡¹ -->
      <view class="nav-item" @click="goPage('/pages/donate/donate')">
        <text class="icon">ğŸ™‡</text>
        <text class="label">èµåŠ©é¸£è°¢</text>
      </view>
      <!-- ç™»å½•/æ³¨å†Œå¯¼èˆªé¡¹ -->
      <view class="nav-item" @click="goPage('/pages/login/login')">
        <text class="icon">ğŸ‘¤</text>
        <text class="label">ç™»å½•/æ³¨å†Œ</text>
      </view>
    </view>

    <!-- æœå†…æ‘„å½±å±•ç¤ºåŒºåŸŸæ ‡é¢˜ -->
    <view class="section-title">ğŸ“· æœå†…æ‘„å½±</view>
    <!-- å±•ç¤ºå¡ç‰‡ -->
    <view class="showcase">
      <view class="card fade-in-left">
        <!-- å±•ç¤ºå›¾ç‰‡ï¼Œå¯ç‚¹å‡»é¢„è§ˆ -->
        <image 
          src="/static/showcase1.jpg" 
          mode="aspectFill"  
          class="card-img zoomable-img"
          @click="previewImage('/static/showcase1.jpg')"
        ></image><!-- ä¿æŒå®½é«˜æ¯”å¡«å……ï¼Œå¯èƒ½è£å‰ª -->
        <!-- å¡ç‰‡å†…å®¹ -->
        <view class="card-content">
          <text class="card-title">è‡ªç”±çš„åˆ›é€ ç¯å¢ƒ</text>
          <text class="card-desc">åœ¨è¿™é‡Œï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å¯èƒ½çš„ã€‚ä»å®ä¼Ÿçš„å»ºç­‘åˆ°ç²¾å¯†çš„æœºæ¢°ï¼Œå°½æƒ…æŒ¥æ´’ä½ çš„åˆ›æ„ã€‚</text>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
  export default {
    methods: {
      // è·³è½¬åˆ°æŒ‡å®šé¡µé¢çš„æ–¹æ³•
      goPage(url) {
        uni.navigateTo({ url });  // uni-appé¡µé¢è·³è½¬API
      },
      
      // é¢„è§ˆå›¾ç‰‡æ–¹æ³•ï¼ˆé€šç”¨ï¼‰
      previewImage(url) {
        uni.previewImage({
          urls: [url],  // è¦é¢„è§ˆçš„å›¾ç‰‡æ•°ç»„
          current: 0,   // å½“å‰æ˜¾ç¤ºç¬¬ä¸€å¼ 
          indicator: 'default'  // æ˜¾ç¤ºæŒ‡ç¤ºå™¨
        });
      },
      
      // å¤„ç†ç™»å½•å›è°ƒæ•°æ®çš„æ–¹æ³•ï¼ˆä»login.vueè°ƒç”¨ï¼‰
      handleLoginHook(data) {
        console.log('æ•è·åˆ°ç™»å½•æ•°æ®:', data);
        uni.showLoading({ title: 'æ­£åœ¨ä¿å­˜æ•°æ®...' });
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        uni.setStorageSync('user_uuid', data.token);  // UUID
        uni.setStorageSync('user_name', data.username);  // ç”¨æˆ·å
        
        // âœ… æ–°å¢ï¼šå¤„ç†ç™½åå•çŠ¶æ€
        if (data.whitelist) {
          // ä¿å­˜ç™½åå•çŠ¶æ€ï¼Œç»Ÿä¸€å­˜ä¸ºå­—ç¬¦ä¸²
          uni.setStorageSync('is_whitelisted', data.whitelist);
        } else {
          // é»˜è®¤è®¾ç½®ä¸ºfalse
          uni.setStorageSync('is_whitelisted', 'false');
        }
        
        uni.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' });
        
        // å»¶è¿Ÿè·³è½¬åˆ°ä¸»é¡µ
        setTimeout(() => {
          this.redirectToHome();
        }, 500);
      },
      
      // é‡å®šå‘åˆ°ä¸»é¡µï¼ˆä»login.vueè°ƒç”¨ï¼‰
      redirectToHome() {
        uni.reLaunch({
          url: '/pages/home/home'  // å…³é—­æ‰€æœ‰é¡µé¢ï¼Œæ‰“å¼€ä¸»é¡µ
        });
      }
    },
    
    // é¡µé¢åŠ è½½ç”Ÿå‘½å‘¨æœŸ
    onLoad(options) {
      // æ£€æŸ¥URLæ˜¯å¦æºå¸¦äº†ç™»å½•å›è°ƒå‚æ•°
      if (options.token) {
        uni.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' });
        
        // 1. ä¿å­˜Tokenï¼ˆUUIDï¼‰- ä½¿ç”¨æ­£ç¡®çš„é”®å
        uni.setStorageSync('user_uuid', options.token);
        uni.setStorageSync('userToken', options.token);  // å…¼å®¹æ—§é”®å
        
        // 2. ä¿å­˜ç”¨æˆ·å
        if (options.username) {
          uni.setStorageSync('user_name', options.username);
        }
        
        // 3. ä¿å­˜ç™½åå•çŠ¶æ€ï¼ˆæ³¨æ„å‚æ•°åæ˜¯whitelistï¼Œä¸æ˜¯whitelistedï¼‰
        if (options.whitelist) {
          // ç»Ÿä¸€å­˜ä¸ºis_whitelistedï¼Œä¸home.vueä¿æŒä¸€è‡´
          uni.setStorageSync('is_whitelisted', options.whitelist);
        }
        
        // 4. æ¸…ç†URLå‚æ•°ï¼ˆH5ç¯å¢ƒï¼‰
        // #ifdef H5
        if (window.history.replaceState) {
          // å»é™¤URLä¸­çš„æŸ¥è¯¢å‚æ•°ï¼Œä¿æŒåœ°å€æ æ•´æ´
          window.history.replaceState(null, null, window.location.hash.split('?')[0]);
        }
        // #endif
      }
    }
  }
</script>

<style>
	/* é¡µé¢å®¹å™¨ */
	.container {
		min-height: 100vh;
		background-color: #f7f7f7;
		padding-bottom: 40rpx;
	}

	/* Hero åŒºåŸŸæ ·å¼ */
	.hero {
		height: 450rpx;
		background: linear-gradient(135deg, #333333, #4a4a4a);
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		color: white;
		border-bottom-left-radius: 40rpx;
		border-bottom-right-radius: 40rpx;
		box-shadow: 0 10rpx 30rpx rgba(0,0,0,0.2);
		margin-bottom: 40rpx;
	}
	.logo { width: 180rpx; height: 180rpx; margin-bottom: 20rpx; border-radius: 50%; border: 4rpx solid rgba(255,255,255,0.2); }
	.server-title { font-size: 56rpx; font-weight: bold; letter-spacing: 4rpx; }
	.server-subtitle { font-size: 28rpx; color: #ccc; margin-top: 10rpx; letter-spacing: 2rpx; }
	
	/* å¯¼èˆªå®«æ ¼æ ·å¼ */
	.grid-nav {
		display: flex;
		flex-wrap: wrap;
		padding: 0 20rpx;
		margin-top: -60rpx; /* è®©å¯¼èˆªæ ç¨å¾®ä¸Šæµ®ï¼Œç›–ä½ Hero ä¸€ç‚¹ç‚¹ï¼Œæ›´æœ‰è®¾è®¡æ„Ÿ */
	}
	.nav-item {
		width: 33.33%; /* 3åˆ—å¸ƒå±€ */
		height: 200rpx;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		background: #fff;
		border: 1rpx solid #f0f0f0;
		box-sizing: border-box;
		transition: all 0.2s;
	}
	/* åœ†è§’å¤„ç†ï¼šå·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹ */
	.nav-item:nth-child(1) { border-top-left-radius: 20rpx; }
	.nav-item:nth-child(3) { border-top-right-radius: 20rpx; }
	.nav-item:nth-child(4) { border-bottom-left-radius: 20rpx; }
	.nav-item:nth-child(6) { border-bottom-right-radius: 20rpx; }
	
	.nav-item:active { background-color: #f9f9f9; }
	
	.icon { font-size: 60rpx; margin-bottom: 16rpx; }
	.label { font-size: 28rpx; color: #333; font-weight: 500; }
	
	/* å±•ç¤ºåŒºåŸŸæ ·å¼ */
	.section-title { margin: 40rpx 30rpx 20rpx; font-size: 36rpx; font-weight: bold; color: #333; padding-left: 16rpx; border-left: 8rpx solid #2196f3; }
	.showcase { padding: 0 30rpx; }
	.card { 
		background: #fff; 
		border-radius: 20rpx; 
		overflow: hidden; 
		margin-bottom: 30rpx; 
		box-shadow: 0 8rpx 20rpx rgba(0,0,0,0.06); 
	}
	.card-img { width: 100%; height: 320rpx; }
	.card-content { padding: 30rpx; }
	.card-title { font-size: 34rpx; font-weight: bold; margin-bottom: 16rpx; display: block; color: #333; }
	.card-desc { font-size: 28rpx; color: #666; line-height: 1.6; }
</style>